---
layout: post
published : false  # 글 비공개 설정
title: "[드림핵][Lv.1] command-injection-chatgpt 문제 풀이"
date:   2025-07-15 16:13:00 +0900
categories: [CSecurity]
tags: [wargame, web, command-injection]
---

## 1. 개요 (Overview)

- **플랫폼 (Platform)**: 드림핵
- **문제 이름 (Challenge)**: command-injection-chatgpt
- **분야 (Category)**: 웹해킹
- **문제 링크 (URL)**: [드림핵 워게임](https://dreamhack.io/wargame/challenges/768)


## 2. 문제 분석 (Problem Analysis)

```python
# 예시: app.py
@APP.route('/ping', methods=['GET', 'POST'])
def ping():
    if request.method == 'POST':
        host = request.form.get('host')
        cmd = f'ping -c 3 {host}' # <- 취약점 발생 지점
        try:
            # '/bin/sh -c' 를 통해 cmd 문자열을 쉘에서 직접 실행
            output = subprocess.check_output(['/bin/sh', '-c', cmd], timeout=5) 
            return render_template('ping_result.html', data=output.decode('utf-8'))
        # ... (생략) ...
```

---

### 1. 문제 풀이
- 이 문제의 가장 중요한 부분은 host 파라미터로 받은 사용자 입력을 아무 "검증"도 없이 f-string 을 사용해 cmd 라는 명령어 문자열 그대로 삽입하는 것이다.
- 그리고, cmd 변수 전체를 하나의 명령어로 해석하게 만들어, 공자가 셸 메타 문자(e.g, ;, |, &&, $(...)) 를 이용해 추가적인 명령어를 상입 할 수 있게 한다.


- 그럼 문제는 단순하다. 우리는 먼저 실제로 명령어가 사용이 되는지 확인을 먼저 해보면 된다.

<br>

---

~~~python
127.0.0.1; ls -al
~~~

- 세미콜론(;)으로 앞의 선 명령어가 끝나면 다음 명령어를 실행하도록 하는 셸 메타 문자 이다.
- 실제로 서버에서 실행되는 명령어 : ping -c 3 127.0.0.1; ls -al
- 이렇게 명령어를 치게 되면 아래와 같은 파일 목록이 출력 된다.
	![[[드림핵][Lv.1] command-injection-chatgpt-20250715182624.png]]
- 실제로 서버의 명령어가 실행 되는 것을 확인 되면 그후는 간단하다.
- 우리가 찾고자 하는 flag 파일을 찾고 열어보면 된다.

<br>

---

### 2. flag 읽기 시도
- cat 명령어를 이용해 파일의 내용을 읽어보기를 시도해본다.

```python
127.0.0.1; cat flag.py

또는

127.0.0.1 cat flag.*

```
- 이렇게 입력하게 되면 해당 flag의 값을 확인 할 수 있다.

<br>
---

## 3. 안전한 코드 방식

~~~python

host = request.form.get('host')
# 명령어와 인자를 리스트로 분리하여 전달
# 이렇게 하면 host 변수는 단일 인자로 취급되어 셸 메타 문자가 해석되지 않음
subprocess.check_output(['ping', '-c', '3', host], timeout=5)

~~~

- 위 처러 host 변수에 127.0.0.1; ls 와 같은 값이 들어더라도, 셸은 ls 를 명령어를 해석하지 않고, 127.0.0.1; ls 라는 이상한 호스트 이름에 대해 ping 을 시도 할 뿐이다.


